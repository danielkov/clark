# Requirements Document

## Introduction

This feature introduces two integrated communication capabilities for candidate management: automated email communication via Resend and AI-powered voice screening via ElevenLabs. These features enable organizations to maintain professional communication with candidates throughout the application process and conduct preliminary screening interviews at scale. Both features are gated by subscription benefits to ensure proper access control.

## Glossary

- **System**: The candidate management application
- **Resend**: Third-party email service provider for transactional emails
- **ElevenLabs Agent**: AI-powered conversational agent for voice-based candidate screening
- **Linear Issue**: A task in Linear representing a candidate application
- **Email Thread**: A sequence of related email messages and Linear comments
- **Screening Session**: A voice conversation between a candidate and the ElevenLabs Agent
- **Transcript**: Text record of a completed screening session
- **Benefit**: A feature flag in the subscription system that controls access to functionality
- **Pre-screening**: Initial automated evaluation of candidate applications
- **System Message**: A comment automatically generated by the System
- **User Message**: A comment created by a human user

## Requirements

### Requirement 1

**User Story:** As a hiring manager, I want candidates to receive confirmation emails when they apply, so that they know their application was received successfully.

#### Acceptance Criteria

1. WHEN a candidate submits an application THEN the System SHALL send a confirmation email via Resend to the candidate's email address
2. WHEN the confirmation email is sent THEN the System SHALL add a comment to the candidate's Linear Issue containing the email text content and a note indicating that replies will be sent to the candidate
3. WHEN the organization does not have the email communication benefit THEN the System SHALL prevent sending confirmation emails
4. WHEN the email sending fails THEN the System SHALL log the error and continue processing the application
5. WHEN the confirmation email is sent THEN the System SHALL include the candidate name, organization name, and position title in the email content

### Requirement 2

**User Story:** As a hiring team member, I want to send emails to candidates by commenting on their Linear Issue, so that all communication is centralized in one place.

#### Acceptance Criteria

1. WHEN a user adds a comment to a candidate's Linear Issue THEN the System SHALL send the comment content as an email to the candidate via Resend
2. WHEN a System Message is added to the Linear Issue THEN the System SHALL skip sending an email
3. WHEN the comment is sent as an email THEN the System SHALL add a note to the Linear Issue indicating the email was sent
4. WHEN the organization does not have the email communication benefit THEN the System SHALL prevent sending emails from comments
5. WHEN multiple comments are added in quick succession THEN the System SHALL send each as a separate email

### Requirement 3

**User Story:** As a candidate, I want to reply to emails from the hiring team, so that I can communicate without leaving my email client.

#### Acceptance Criteria

1. WHEN a candidate replies to an email THEN the System SHALL receive the reply via Resend webhook
2. WHEN the System receives a candidate email reply THEN the System SHALL add the email content as a System Message to the corresponding Linear Issue
3. WHEN the System receives a candidate email THEN the System SHALL preserve the email formatting and content
4. WHEN the System cannot match the email to a Linear Issue THEN the System SHALL log the error and notify administrators
5. WHEN the webhook payload is invalid THEN the System SHALL return an error response and log the failure

### Requirement 4

**User Story:** As a hiring manager, I want to send rejection emails to candidates who are not selected, so that they receive timely feedback.

#### Acceptance Criteria

1. WHEN a candidate's Linear Issue is moved to a rejected state THEN the System SHALL send a rejection email via Resend
2. WHEN the rejection email is sent THEN the System SHALL add a comment to the Linear Issue documenting the rejection email
3. WHEN the organization does not have the email communication benefit THEN the System SHALL prevent sending rejection emails
4. WHEN the rejection email is sent THEN the System SHALL include the candidate name and position title
5. WHEN the candidate has already been rejected THEN the System SHALL prevent sending duplicate rejection emails

### Requirement 5

**User Story:** As a hiring manager, I want candidates who pass pre-screening to receive an AI screening invitation, so that I can evaluate more candidates efficiently.

#### Acceptance Criteria

1. WHEN a candidate passes pre-screening THEN the System SHALL send an email via Resend containing the ElevenLabs Agent session link
2. WHEN the screening invitation email is sent THEN the System SHALL add a comment to the Linear Issue documenting the invitation
3. WHEN the organization does not have the AI screening benefit THEN the System SHALL prevent sending screening invitations
4. WHEN the screening invitation is sent THEN the System SHALL include the candidate name, organization name, and position title
5. WHEN the ElevenLabs Agent session link generation fails THEN the System SHALL log the error and notify administrators

### Requirement 6

**User Story:** As a hiring manager, I want the ElevenLabs Agent to have context about the candidate and position, so that the screening conversation is relevant and personalized.

#### Acceptance Criteria

1. WHEN the System generates an ElevenLabs Agent session THEN the System SHALL provide the organization name as a variable
2. WHEN the System generates an ElevenLabs Agent session THEN the System SHALL provide the complete Linear Issue content as the job application variable
3. WHEN the System generates an ElevenLabs Agent session THEN the System SHALL provide the job description from the Linear Project content
4. WHEN the System generates an ElevenLabs Agent session THEN the System SHALL generate conversation pointers using Cerebras based on the job description and candidate application
5. WHEN the System generates an ElevenLabs Agent session THEN the System SHALL provide the candidate's first name as a variable

### Requirement 7

**User Story:** As a hiring manager, I want screening transcripts to be evaluated automatically, so that I can focus on qualified candidates.

#### Acceptance Criteria

1. WHEN a candidate completes an ElevenLabs screening session THEN the System SHALL receive the transcript via webhook
2. WHEN the System receives a screening transcript THEN the System SHALL evaluate it using Cerebras to determine pass, fail, or inconclusive status
3. WHEN the evaluation result is pass THEN the System SHALL advance the candidate's Linear Issue to the next stage
4. WHEN the evaluation result is fail THEN the System SHALL move the candidate's Linear Issue to rejected state
5. WHEN the evaluation result is inconclusive THEN the System SHALL maintain the candidate's current stage

### Requirement 8

**User Story:** As a hiring manager, I want screening transcripts attached to candidate issues, so that I can review the conversation details.

#### Acceptance Criteria

1. WHEN the System receives a screening transcript THEN the System SHALL attach the transcript as a file to the candidate's Linear Issue
2. WHEN the transcript is attached THEN the System SHALL add a comment to the Linear Issue summarizing the evaluation result
3. WHEN the transcript attachment fails THEN the System SHALL log the error and add the transcript content as a comment instead
4. WHEN the transcript is attached THEN the System SHALL preserve the complete conversation including timestamps
5. WHEN the System receives a transcript for an unknown candidate THEN the System SHALL log the error and notify administrators

### Requirement 9

**User Story:** As a system administrator, I want benefit checks to be enforced consistently, so that only authorized organizations can use premium features.

#### Acceptance Criteria

1. WHEN any email communication feature is accessed THEN the System SHALL verify the organization has the email communication benefit
2. WHEN any AI screening feature is accessed THEN the System SHALL verify the organization has the AI screening benefit
3. WHEN a benefit check fails THEN the System SHALL prevent the action and log the attempt
4. WHEN a benefit check fails THEN the System SHALL return a clear error message indicating the missing benefit
5. WHEN benefit status changes THEN the System SHALL apply the new permissions immediately
